<template>
  <div v-if="data" class="container flex gap-4 mx-auto p-4">
    <div
      class="bg-white dark:bg-gray-900 flex-1 max-w-sm mx-auto overflow-hidden rounded-lg shadow-lg"
    >
      <div class="border-b pb-6 px-4">
        <div class="my-4 text-center">
          <img
            :alt="data.user.fullName"
            class="border-4 border-white dark:border-gray-800 h-32 mx-auto my-4 rounded-full w-32"
            :src="data.user.avatar"
          />
          <div class="py-2">
            <h3 class="dark:text-white font-bold mb-1 text-2xl text-gray-800">
              {{ data.user.fullName }}
            </h3>
            <div
              class="dark:text-gray-300 inline-flex items-left text-gray-700 w-full"
            >
              <svg
                class="dark:text-gray-600 h-5 mr-1 text-gray-400 w-5"
                fill="currentColor"
                height="24"
                viewBox="0 0 24 24"
                width="24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  class=""
                  d="M5.64 16.36a9 9 0 1 1 12.72 0l-5.65 5.66a1 1 0 0 1-1.42 0l-5.65-5.66zm11.31-1.41a7 7 0 1 0-9.9 0L12 19.9l4.95-4.95zM12 14a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"
                />
              </svg>
              {{ data.user.physicalAddress }}
            </div>
            <div
              class="dark:text-gray-300 inline-flex items-left text-gray-700 w-full"
            >
              <svg
                id="Email_Open_24"
                height="24"
                viewBox="0 0 24 24"
                width="24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect
                  fill="#000000"
                  height="24"
                  opacity="0"
                  stroke="none"
                  width="24"
                />
                <g transform="matrix(0.45 0 0 0.45 12 12)">
                  <path
                    d="M 25 3 C 24.065529 3 22.342634 3.1922485 20.857422 4.4609375 C 20.398681 4.8083214 19.373867 5.711436 17.886719 7 L 11 7 C 10.447738123791542 7.0000552179053495 10.000055217905349 7.447738123791542 10 8 L 10 13.962891 C 6.471313 17.084086 3.3339844 19.878906 3.3339844 19.878906 C 3.1214614918538506 20.06867560710598 2.9999682606298403 20.340081609472698 3 20.625 L 3 46 C 3.000055217905349 46.55226187620846 3.4477381237915408 46.99994478209465 4 47 L 46 47 C 46.55226187620846 46.99994478209465 46.99994478209465 46.55226187620846 47 46 L 47 20.625 C 47.000031841108616 20.340081671897863 46.878538759845775 20.06867567947991 46.666016 19.878906 C 46.666016 19.878906 43.528795 17.083407 40 13.962891 L 40 8 C 39.99994478209465 7.447738123791541 39.55226187620846 7.0000552179053495 39 7 L 32.052734 7 C 30.621699 5.7124523 29.597448 4.8047971 29.140625 4.4589844 C 27.65593 3.1920488 25.933993 3 25 3 z M 25 5 C 25.639946 5 26.886525 5.1588743 27.849609 5.984375 C 27.866085520085996 5.998595799359689 27.88302187253336 6.012274950583353 27.900391 6.0253906 C 27.959185 6.0694411 28.697665 6.7277272 29.013672 7 L 20.960938 7 C 21.279381 6.7285566 22.041101 6.0692269 22.099609 6.0253906 C 22.11697812746664 6.012274950583352 22.133914479914004 5.998595799359689 22.150391 5.984375 C 23.113477 5.1588747 24.360054 5 25 5 z M 12 9 L 17.988281 9 C 18.144192542444436 9.038082487204836 18.306979457555563 9.038082487204836 18.462891 9 L 31.513672 9 C 31.62803267465632 9.020067433837593 31.74501432534368 9.020067433837593 31.859375 9 L 38 9 L 38 14.417969 L 38 26.542969 L 32.361328 30.980469 C 31.298143 30.145647 29.356777 28.62871 29.125 28.443359 C 27.584365 27.210381 25.936054 27 25 27 C 23.990342 27 22.424011 27.305375 20.908203 28.417969 C 20.632913 28.619667 18.627455 30.201185 17.632812 30.976562 L 12 26.542969 L 12 14.546875 C 12.015162902979911 14.447187958264486 12.015162902979911 14.345781041735513 12 14.246094 L 12 9 z M 16 14 C 15.63936408342243 13.994899710454515 15.303918635428394 14.184375296169332 15.122112278513482 14.495872849714331 C 14.940305921598572 14.80737040325933 14.940305921598572 15.192629596740671 15.122112278513484 15.50412715028567 C 15.303918635428394 15.815624703830668 15.639364083422432 16.005100289545485 16 16 L 34 16 C 34.36063591657757 16.005100289545485 34.696081364571604 15.815624703830668 34.877887721486516 15.504127150285669 C 35.05969407840143 15.192629596740671 35.05969407840143 14.80737040325933 34.877887721486516 14.495872849714331 C 34.696081364571604 14.184375296169332 34.36063591657757 13.994899710454515 34 14 L 16 14 z M 10 16.636719 L 10 24.966797 L 5.0253906 21.050781 C 5.2639072 20.838199 7.6995528 18.67611 10 16.636719 z M 40 16.636719 C 42.300878 18.676338 44.736918 20.840822 44.974609 21.052734 L 40 24.96875 L 40 16.636719 z M 16 19 C 15.63936408342243 18.994899710454515 15.303918635428394 19.184375296169332 15.122112278513482 19.49587284971433 C 14.940305921598572 19.80737040325933 14.940305921598572 20.192629596740673 15.122112278513484 20.50412715028567 C 15.303918635428394 20.815624703830668 15.639364083422432 21.005100289545485 16 21 L 27 21 C 27.360635916577568 21.005100289545485 27.696081364571608 20.815624703830668 27.877887721486516 20.50412715028567 C 28.059694078401428 20.19262959674067 28.059694078401428 19.80737040325933 27.877887721486516 19.49587284971433 C 27.696081364571608 19.184375296169332 27.360635916577568 18.994899710454515 27 19 L 16 19 z M 5 23.578125 L 16.009766 32.244141 C 14.380662 33.519885 13.64873 34.080591 11.683594 35.625 C 8.2747801 38.304 6.1117199 40.008897 5 40.884766 L 5 23.578125 z M 45 23.578125 L 45 40.888672 C 43.543056 39.746848 38.508414 35.801673 33.982422 32.251953 L 45 23.578125 z M 25 29 C 25.639946 29 26.791635 29.138837 27.875 30.005859 C 29.231039 31.090278 44.471585 43.016199 45 43.429688 L 45 45 L 5 45 L 5 43.427734 C 5.2740923 43.211869 8.8819407 40.370731 12.919922 37.197266 C 17.108371 33.905547 21.554155 30.425166 22.091797 30.03125 C 23.199989 29.217844 24.433658 29 25 29 z"
                    stroke-linecap="round"
                    style="
                      stroke: none;
                      stroke-width: 1;
                      stroke-dasharray: none;
                      stroke-linecap: butt;
                      stroke-dashoffset: 0;
                      stroke-linejoin: miter;
                      stroke-miterlimit: 4;
                      fill: rgb(0, 0, 0);
                      fill-rule: nonzero;
                      opacity: 1;
                    "
                    transform=" translate(-25, -25)"
                  />
                </g>
              </svg>
              {{ data.user.email }}
            </div>
            <div
              class="dark:text-gray-300 inline-flex items-left text-gray-700 w-full"
            >
              <svg
                id="Business_Building_24"
                height="24"
                viewBox="0 0 24 24"
                width="24"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <rect
                  fill="#000000"
                  height="24"
                  opacity="0"
                  stroke="none"
                  width="24"
                />
                <g transform="matrix(0.43 0 0 0.43 12 12)">
                  <path
                    d="M 7 2 L 7 7 L 2 7 L 2 46 L 14 46 L 14 44 L 4 44 L 4 9 L 9 9 L 9 4 L 29 4 L 29 7 L 11 7 L 11 9 L 34 9 L 34 20 L 36 20 L 36 7 L 31 7 L 31 2 Z M 8 12 L 8 14 L 12 14 L 12 12 Z M 17 12 L 17 14 L 21 14 L 21 12 Z M 26 12 L 26 14 L 30 14 L 30 12 Z M 8 17 L 8 19 L 12 19 L 12 17 Z M 17 17 L 17 19 L 21 19 L 21 17 Z M 26 17 L 26 19 L 30 19 L 30 17 Z M 29 20 C 25.742188 20 23.328125 21.324219 22.074219 23.296875 C 20.929688 25.09375 20.875 27.339844 21.59375 29.433594 C 21.515625 29.566406 21.402344 29.679688 21.328125 29.839844 C 21.171875 30.191406 21.035156 30.589844 21.054688 31.097656 L 21.054688 31.101563 C 21.109375 32.378906 21.851563 33.046875 22.398438 33.421875 C 22.628906 34.640625 23.207031 35.660156 24 36.390625 L 24 38.53125 C 23.824219 38.953125 23.472656 39.308594 22.796875 39.679688 C 22.089844 40.070313 21.132813 40.4375 20.144531 40.917969 C 19.15625 41.398438 18.125 42.011719 17.324219 42.988281 C 16.519531 43.96875 16 45.308594 16 47 L 16 48 L 48.050781 48 L 47.992188 46.941406 C 47.902344 45.363281 47.316406 44.117188 46.488281 43.222656 C 45.664063 42.328125 44.644531 41.765625 43.679688 41.320313 C 42.714844 40.875 41.785156 40.535156 41.109375 40.171875 C 40.464844 39.832031 40.148438 39.511719 40 39.160156 L 40 37.472656 C 40.597656 36.609375 40.859375 35.617188 40.9375 34.6875 C 41.414063 34.265625 41.96875 33.617188 42.125 32.457031 C 42.230469 31.625 42.019531 30.996094 41.695313 30.464844 C 42.144531 29.277344 42.328125 27.84375 41.933594 26.417969 C 41.707031 25.589844 41.277344 24.777344 40.5625 24.171875 C 40.003906 23.691406 39.238281 23.425781 38.390625 23.308594 L 37.75 22 L 37.125 22 C 36.097656 22 35.085938 22.238281 34.214844 22.578125 C 33.871094 22.714844 33.558594 22.863281 33.265625 23.027344 C 33.101563 22.808594 32.921875 22.601563 32.714844 22.414063 C 32.105469 21.863281 31.261719 21.550781 30.324219 21.421875 L 29.621094 20 Z M 8 22 L 8 24 L 12 24 L 12 22 Z M 17 22 L 17 24 L 19.484375 24 L 20.761719 22 Z M 28.4375 22.113281 L 29.027344 23.300781 L 29.644531 23.300781 C 30.464844 23.300781 30.96875 23.535156 31.371094 23.894531 C 31.773438 24.257813 32.066406 24.796875 32.238281 25.429688 C 32.582031 26.695313 32.289063 28.339844 32.007813 28.792969 L 31.644531 29.371094 L 32.050781 29.921875 C 32.289063 30.238281 32.441406 30.566406 32.363281 31.007813 C 32.253906 31.625 32.03125 31.707031 31.589844 32.089844 L 31.257813 32.375 L 31.246094 32.8125 C 31.210938 33.792969 30.871094 34.777344 30.300781 35.339844 L 30 35.632813 L 30 38.988281 L 30.058594 39.152344 C 30.453125 40.25 31.335938 40.933594 32.234375 41.429688 C 33.132813 41.925781 34.101563 42.289063 34.976563 42.714844 C 35.851563 43.140625 36.609375 43.625 37.132813 44.261719 C 37.496094 44.699219 37.71875 45.289063 37.855469 46 L 18.144531 46 C 18.28125 45.289063 18.503906 44.699219 18.867188 44.261719 C 19.390625 43.625 20.148438 43.140625 21.023438 42.714844 C 21.898438 42.289063 22.867188 41.925781 23.765625 41.429688 C 24.664063 40.933594 25.546875 40.25 25.941406 39.152344 L 26 38.988281 L 26 35.523438 L 25.5625 35.226563 C 25.101563 34.914063 24.34375 33.769531 24.238281 32.742188 L 24.183594 32.1875 L 23.683594 31.945313 C 23.398438 31.808594 23.082031 31.753906 23.050781 31.015625 C 23.050781 31.015625 23.082031 30.824219 23.15625 30.65625 C 23.234375 30.484375 23.375 30.304688 23.332031 30.347656 L 23.8125 29.867188 L 23.542969 29.242188 C 22.796875 27.523438 22.898438 25.722656 23.761719 24.367188 C 24.550781 23.125 26.097656 22.269531 28.4375 22.113281 Z M 36.558594 24.113281 L 37.089844 25.199219 L 37.714844 25.199219 C 38.472656 25.199219 38.921875 25.398438 39.265625 25.691406 C 39.613281 25.984375 39.859375 26.414063 40.003906 26.949219 C 40.300781 28.019531 40.085938 29.480469 39.746094 30.144531 L 39.417969 30.796875 L 39.933594 31.308594 C 39.867188 31.242188 40.195313 31.785156 40.140625 32.195313 C 40.011719 33.175781 39.871094 33.113281 39.449219 33.390625 L 39.03125 33.667969 L 39 34.171875 C 38.953125 35.042969 38.515625 36.351563 38.28125 36.589844 L 38 36.878906 L 38 39.621094 L 38.058594 39.78125 C 38.4375 40.835938 39.296875 41.476563 40.167969 41.9375 C 41.035156 42.398438 41.980469 42.738281 42.84375 43.136719 C 43.707031 43.535156 44.476563 43.984375 45.019531 44.578125 C 45.367188 44.953125 45.601563 45.433594 45.769531 46 L 39.921875 46 C 39.757813 44.777344 39.3125 43.765625 38.675781 42.988281 C 37.875 42.011719 36.84375 41.398438 35.855469 40.917969 C 34.867188 40.4375 33.910156 40.070313 33.203125 39.679688 C 32.527344 39.308594 32.175781 38.953125 32 38.53125 L 32 36.296875 C 32.691406 35.421875 33.054688 34.390625 33.15625 33.34375 C 33.542969 33.003906 34.144531 32.417969 34.332031 31.359375 C 34.484375 30.492188 34.226563 29.785156 33.90625 29.210938 C 34.4375 27.988281 34.59375 26.460938 34.167969 24.902344 C 34.164063 24.886719 34.15625 24.871094 34.152344 24.855469 C 34.367188 24.71875 34.640625 24.5625 34.949219 24.441406 C 35.4375 24.25 36.007813 24.179688 36.558594 24.113281 Z M 8 27 L 8 29 L 12 29 L 12 27 Z M 17 27 L 17 29 L 19.753906 29 L 19.394531 27 Z M 8 32 L 8 34 L 12 34 L 12 32 Z M 17 32 L 17 34 L 20.449219 34 L 19.613281 32 Z M 8 37 L 8 39 L 12 39 L 12 37 Z M 17 37 L 17 39 L 21 39 L 21 37 Z"
                    stroke-linecap="round"
                    style="
                      stroke: none;
                      stroke-width: 1;
                      stroke-dasharray: none;
                      stroke-linecap: butt;
                      stroke-dashoffset: 0;
                      stroke-linejoin: miter;
                      stroke-miterlimit: 4;
                      fill: rgb(0, 0, 0);
                      fill-rule: nonzero;
                      opacity: 1;
                    "
                    transform=" translate(-25.03, -25)"
                  />
                </g>
              </svg>
              {{ data.user.workplace }}
            </div>
            <div
              class="dark:text-gray-300 inline-flex items-left text-gray-700 w-full"
            >
              <svg
                id="Phone_24"
                height="24"
                viewBox="0 0 24 24"
                width="24"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <rect
                  fill="#000000"
                  height="24"
                  opacity="0"
                  stroke="none"
                  width="24"
                />
                <g transform="matrix(0.45 0 0 0.45 12 12)">
                  <path
                    d="M 11.839844 2.988281 C 11.070313 2.925781 10.214844 3.148438 9.425781 3.703125 C 8.730469 4.1875 7.230469 5.378906 5.828125 6.726563 C 5.128906 7.398438 4.460938 8.097656 3.945313 8.785156 C 3.425781 9.472656 2.972656 10.101563 3 11.015625 C 3.027344 11.835938 3.109375 14.261719 4.855469 17.980469 C 6.601563 21.695313 9.988281 26.792969 16.59375 33.402344 C 23.203125 40.011719 28.300781 43.398438 32.015625 45.144531 C 35.730469 46.890625 38.160156 46.972656 38.980469 47 C 39.890625 47.027344 40.519531 46.574219 41.207031 46.054688 C 41.894531 45.535156 42.59375 44.871094 43.265625 44.171875 C 44.609375 42.769531 45.800781 41.269531 46.285156 40.574219 C 47.390625 39 47.207031 37.140625 45.976563 36.277344 C 45.203125 35.734375 38.089844 31 37.019531 30.34375 C 35.933594 29.679688 34.683594 29.980469 33.566406 30.570313 C 32.6875 31.035156 30.308594 32.398438 29.628906 32.789063 C 29.117188 32.464844 27.175781 31.171875 23 26.996094 C 18.820313 22.820313 17.53125 20.878906 17.207031 20.367188 C 17.597656 19.6875 18.957031 17.320313 19.425781 16.425781 C 20.011719 15.3125 20.339844 14.050781 19.640625 12.957031 C 19.347656 12.492188 18.015625 10.464844 16.671875 8.429688 C 15.324219 6.394531 14.046875 4.464844 13.714844 4.003906 L 13.714844 4 C 13.28125 3.402344 12.605469 3.050781 11.839844 2.988281 Z M 11.65625 5.03125 C 11.929688 5.066406 12.09375 5.175781 12.09375 5.175781 C 12.253906 5.398438 13.65625 7.5 15 9.53125 C 16.34375 11.566406 17.714844 13.652344 17.953125 14.03125 C 17.992188 14.089844 18.046875 14.753906 17.65625 15.492188 L 17.65625 15.496094 C 17.214844 16.335938 15.15625 19.933594 15.15625 19.933594 L 14.871094 20.4375 L 15.164063 20.9375 C 15.164063 20.9375 16.699219 23.527344 21.582031 28.410156 C 26.46875 33.292969 29.058594 34.832031 29.058594 34.832031 L 29.558594 35.125 L 30.0625 34.839844 C 30.0625 34.839844 33.652344 32.785156 34.5 32.339844 C 35.238281 31.953125 35.902344 32.003906 35.980469 32.050781 C 36.671875 32.476563 44.355469 37.582031 44.828125 37.914063 C 44.84375 37.925781 45.261719 38.558594 44.652344 39.425781 L 44.648438 39.425781 C 44.28125 39.953125 43.078125 41.480469 41.824219 42.785156 C 41.195313 43.4375 40.550781 44.046875 40.003906 44.457031 C 39.457031 44.867188 38.96875 44.996094 39.046875 45 C 38.195313 44.972656 36.316406 44.953125 32.867188 43.332031 C 29.417969 41.714844 24.496094 38.476563 18.007813 31.984375 C 11.523438 25.5 8.285156 20.578125 6.664063 17.125 C 5.046875 13.675781 5.027344 11.796875 5 10.949219 C 5.003906 11.027344 5.132813 10.535156 5.542969 9.988281 C 5.953125 9.441406 6.558594 8.792969 7.210938 8.164063 C 8.519531 6.910156 10.042969 5.707031 10.570313 5.339844 L 10.570313 5.34375 C 11.003906 5.039063 11.382813 5 11.65625 5.03125 Z"
                    stroke-linecap="round"
                    style="
                      stroke: none;
                      stroke-width: 1;
                      stroke-dasharray: none;
                      stroke-linecap: butt;
                      stroke-dashoffset: 0;
                      stroke-linejoin: miter;
                      stroke-miterlimit: 4;
                      fill: rgb(0, 0, 0);
                      fill-rule: nonzero;
                      opacity: 1;
                    "
                    transform=" translate(-25.01, -24.99)"
                  />
                </g>
              </svg>
              {{ data.user.phoneNumber }}
            </div>
            <div
              class="dark:text-gray-300 inline-flex items-left text-gray-700 w-full"
            >
              <a
                class="hover:text-gray-700 hover:underline text-emerald-500"
                :href="data.user.website"
                target="_blank"
              >
                {{ data.user.website }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ul class="flex-1 gap-4 grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3">
      <PostCard v-for="post in sortedPosts" :key="post.id" :post="post" />
      <li v-if="sortedPosts.length === 0">
        <div class="bg-white p-4 rounded-lg shadow-lg">
          <p>Netika atrasta neviena zi≈Üa.</p>
        </div>
      </li>
    </ul>
  </div>
</template>

<script setup lang="ts">
import { defineProps } from 'vue'
import PostCard from '@/components/PostCard.vue'
import { parseErrorAndShowMessage } from '@/helpers/global'
import { ref, computed } from 'vue'
import type { UserPageData } from '@/types/Data'

const props = defineProps<{ id: number }>()

const data = ref<UserPageData>()
const loadPosts = async () => {
  try {
    data.value = (await (
      await fetch(`${import.meta.env.VITE_API_BASE_URL}/user/${props.id}`)
    ).json()) as UserPageData
  } catch (e) {
    console.error(e)
    parseErrorAndShowMessage(e)
  }
}
loadPosts()

const sortedPosts = computed(() => {
  if (!data.value) return []
  return data.value.user.posts
    .slice()
    .sort(
      (a, b) =>
        new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime(),
    )
})
</script>
